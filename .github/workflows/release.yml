name: release-with-tag

on:
  push:
    tags:
      - 'v*'

env:
  NAR_NAME: Haine
  FETCH_DEPTH: 10

jobs:
  release-with-tag:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: ${{ env.FETCH_DEPTH }}

    - name: Zip output
      run: |
        zip -r ${{ env.NAR_NAME }}.nar * -x readme.md -x .git/\* -x .github/\* -x .git* -x ${{ env.NAR_NAME }}.nar -x ghost/master/rustfmt.toml -x ghost/master/.cargo\* -x ghost/master/Cargo\* -x ghost/master/src/\* -x ghost/master/ipadic\* -x md5buildignore.txt -x build\*

    - name: Upload Release Asset(with tag)
      uses: softprops/action-gh-release@v2
      with:
        files: |
          ${{ env.NAR_NAME }}.nar
        body: |
          ${{ env.BODY }}
