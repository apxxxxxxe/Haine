use crate::events::IMMERSIVE_ICON_COUNT;
use once_cell::sync::Lazy;

pub(crate) const FIRST_BOOT_MARKER: &str = "邂逅";

pub(crate) static FIRST_BOOT_TALK: Lazy<String> = Lazy::new(|| {
  format!("\\t\\*\
    h1000000\\1\\b[10]────今夜、私は死にに行く。\
    \\x\
    \\1\\b[10]短い遺書を書き、身支度を終え、真夜中の街道を静かに歩く。\\n\
    行き先は決めていた。死に場所ぐらい、自分の意志で選びたかったから。\\n\
    \\n\
    タクシーを捕まえ、乗り込む。\\n\
    \\x[noclear]\
    \\n\
    「お客さん、行き先は？」\\n\
    当然の問い。私は口を開く代わりに、小さなノートに書いた文字を見せる。\\n\
    『カンテルベリオ、郊外〇〇通りへ』\\_w[1200]\\n\
    運転手は私の行動にすこし驚いたような顔をしたが、それ以上追及はしなかった。\\n\
    \\x\
    \\1\\b[10]私は産声を上げない子だった。\\n\
    喉の形成異常で、声を持たずに産まれたからだ。\\n\\_w[1200]\
    \\n\
    家族には腫れ物のように扱われ、\\n\
    心から話せる友達はついぞできなかった。\\n\
    罵りは稀だったが、それを幸いと言う他人とは縁を切った。\\n\
    やがて学校は辞めた。紆余曲折あったが、幸運なことに職にはありつけた。\\n\
    新たな上司は理解があり、概ね上手くやっていた。\\n\\_w[1200]\
    \\n\
    だが、全てを投げ出した。\\n\
    \\n\
    何故か。\\n\
    私が何より求めるものは\\n\
    この先ずっと手に入らないことを悟ったのだ。\\n\
    \\n\
    少し意思伝達の方法が違うだけで\\n\
    私は他の人間の輪から外れてしまった。\\n\
    誰が悪いのだろうか。\\n\
    きっと誰も悪くないのだろう。\\n\
    これからする行為によって、\\n\
    誰かに何かを伝えようという意図はない。\\n\
    単に私は私を殺すことで、せめて苦しみを終わらせるのだ。\\n\
    \\x\
    \\1\\b[10]…………。\\n\
    しばらく揺られるうちに眠っていたらしい。気づけば目的地に着いていた。\\n\
    荷物をまとめ、タクシーを降りる。\\n\
    いよいよだ。\\n\
    \\x[noclear]\
    \\n\
    カンテルベリオ。その辺鄙な都市の、さらに郊外に位置する古い廃墟。\\n\
    「カンテルベリオの幽霊屋敷」は、\\n\
    その手のマニアの間では有名な廃墟だ。\\n\
    古い洋館で、周囲は小さな庭園に囲まれている。\\n\
    噂によると所有者は存在するらしいが、ずっと住んでいないという。\\n\
    これだけ話題になりながら依然として放置されている理由は謎であり、数々の憶測を呼んでいる。\\n\
    \\n\
    昔から廃墟は好きだった。かつての気配を残しながら、忘れ去られてしまった物たちがひっそりとたたずむ姿を美しいと思った。\\n\
    そして、自分もその中で朽ちていけたらと。\\n\
    \\x\
    \\1\\b[10]幽霊屋敷と呼ばれる通り、\\n\
    ここには女の幽霊が出るという。\\n\
    目撃情報は多々あり、そして、見た者の多くが病気や事故に遭っている。\\n\
    それは呪いによるものなのか、それともただの偶然か。\\n\
    どちらかといえば後者を信じるたちだが、どちらでも構わない。\\n\
    何にせよ、憧れたもののもとで、私は死ぬ。\
    \\x\
    \\1\\b[10]霧の濃い日だ。カンテルベリオではままあることらしい。\\n\
    数メートル先も見通せないほどの霧だが、不思議と濡れた感じがしない。\\n\
    むしろ乾ききっているような気がして、背筋に嫌なものを感じる。\\n\
    ……廃墟を目の前にして萎縮しているのだろうか。\\n\
    いや、ここまで来たのだから、引き返すわけにはいかない。\\n\
    私は歩き出した。\
    \\x\
    \\1\\b[10]廃墟の門は錆びつき、固く閉ざされていた。\\n\
    塀の上には、鉄の棘が生えている。写真で確認していた通りだ。\\n\
    荒い麻布を掛けて、その上を乗り越える。\\n\
    運動など全くしない私はそれだけで息が上がってしまった。\\n\
    \\n\
    息を整え、改めてその館を見上げる。\\n\
    その姿は、威圧的で、美しい。\\n\
    ……だが、まごうことなき不法侵入だ。\\n\
    憧れの場所で、生まれて初めて罪を犯した。\\n\
    罪悪感と、興奮。\\n\
    息をつく間もなく私は歩きだしていた。\\n\
    \\x\
    \\1\\b[10]玄関の重い扉を開けると、中は暗かった。\\n\
    埃っぽさは無いが、しかし生活感もない。\\n\
    窓をきっちりと覆っている重たげなカーテンは、長いあいだ開いていないようだった。\\n\
    \\x\
    \\1しばらく歩き、階段を登り、\\p[2]\\s[10000000]\
    \\1\\n客間へと入ったときだった。\\n\
    人の気配。\\_w[1000]\\n\
    部屋の中央、向かい合ったソファの手前側に座る人影があった。\\n\
    それは静かに立ち上がり、こちらに向き直る。\\n\
    \
    \\p[2]\\![bind,icon,没入度1,1]\\0\\![bind,シルエット,黒塗り1,1]h1111201\\_w[1000]\
    ────また一人、新しいお客様。\\n\
    \\p[2]\\![bind,icon,没入度2,1]\\0\\![bind,シルエット,黒塗り2,1]\
    腕に麻の欠片がついているわ。\\n\
    \\p[2]\\![bind,icon,没入度3,1]\\0\\![anim,offset,800002,0,-100]\
    夜を狙って、こっそりと忍び込んだのね。\\n\
    \\p[2]\\![bind,icon,没入度4,1]\\0\\![anim,offset,800002,0,-150]\
    そうして、私のもとに。\\n\
    \\p[2]\\![bind,icon,没入度5,1]\\0\\![anim,offset,800002,0,-250]\
    いつも疑問に思っているのよ。\\n\
    そうまでして得たいものって何かしら？\\n\
    \
    \\![bind,シルエット,黒塗り4,1]\
    h1111201好奇心は尊く、そして卑しい。\\n\
    あなたもそう思わない？\\n\\n\
    \
    \\1かすかな衣擦れの音とともに暗がりから現れた人影は、少女のようだった。\\n\
    僅かに安堵、そして拍子抜けした気持ちは、すぐに不安に塗り潰された。\\n\
    人影というにはひどく違和感がある。\\n\
    暗がりで妖しく光る真っ赤な瞳、死人のように血の気のない肌。\\n\
    人の形をしてはいる。しかし、だからこそ明らかにわかってしまう。目の前の少女は……。\\n\\n\
    \
    \\0\\![bind,シルエット,黒塗り4,0]\
    h1111204人間ではない。\
    \
    \\1！……考えを読まれた？\
    \
    \\x\
    \
    h1111210安心なさい、表情を見ているだけよ。\\n\
    \\1表情を見るだけで……？\\n\
    真偽はともかく、見透かされているようで気味が悪い。\\n\
    しかし、幽霊……まさか本当に……。\\n\\n\
    \
    h1111204目の前にいるのだから、あなたは信じるしかないのよ。\\n\
    h1111310「カンテルベリオの幽霊」、おおかたあの噂を聞いてきたのでしょう。\\n\\n\
    h1112304おめでとう、私が件の幽霊、そしてこの館の主よ。\\n\
    \\x\
    \
    ……h1111210さて、ここを訪れるほどのことだから、あなたは私たちに興味があるのでしょうね。\\n\
    オカルトフリークが廃墟探索、珍しいことじゃないわ。\\n\\n\
    \\1……微妙に違っていたが、少女は有無を言わせぬ口調で続ける。\\n\
    h1111304あなたたちにとって、理外の存在は魅力的だものね？\\n\
    h1111206その自由さ、存在の不思議さ、\\n\
    あるいはもっと純粋な……\\n\
    h1111306死そのものへのあこがれ。\\n\
    あなたは少なからず、それらを抱いていた。\\n\
    h1111210だからあなたはここに来たのでしょう。\\n\
    \\n\
    \\1……。\
    h1111210…h1111110…h1111106……h1121306ふん、\\n\
    あなたのような輩はいつもそう。\
    \\x\
    \
    h1111301ねえ、少し頭を使えばわかるはずよ。\\n\
    廃墟とはいえ他人の家。\\n\
    くだらないことで踏み荒らされて、\\n\
    家主が許すわけがないでしょう？\\n\
    h1111304こんな簡単なことを理解できない人間がいる。\\n\
    不思議でならないわ。\\n\
    ねえ、あなたに言っているのよ。\
    \\n\\n\
    \\p[2]\
    \\![bind,icon,,0]\
    {}\
    \\0\\![bind,シルエット,黒塗り2,1]\\![bind,ex,こわいかお,1]\\f[bold,1]\
    {}\\f[bold,0]\
    \
    \\1\\![set,balloonwait,0.5]一瞬にして少女の雰囲気が変わった。\\n\
    理解するより先に、身体ががたがた震え出す。\\![set,balloonwait,1]\
    \\x\
    \\1怖い。怖い。\\n\
    頭の中からそれ以外の思考が消える。\\n\
    これが、こんな存在が現実にいたなんて。\\n\
    空気がどろりと濁って見えるほどの、凄まじい敵意。\\n\
    \
    h1111201……怖い？怖いのでしょうね。\\n\
    ああ、至極どうでもいいわ。\\n\
    下手人の感情など、羽虫ほどの価値もない。\\n\
    \\n\
    h1111206ふざけた輩には病を憑けて帰しているのだけど、\\n\
    h1111204あなたは……h1111310どうしてあげようかしら。\\n\
    そうね、糞とはらわたをかき混ぜて殺せば\\n\
    少しは溜飲も下がるかしら？\\n\
    苦しむあなたの顔、最期の瞬間まで見ていてあげる。\\n\
    \\x\\1殺す。眼の前の少女はこともなげに言った。\\n\
    気負った色はない。脅しではないのだ。\\n\
    \\0なにか弁明はあるかしら？\\n\
    私を侵すに足る理由があるのなら聞きましょう。\\n\
    \\1……発言を、求められている。それを理解した瞬間、\\n\
    すっと頭が冷える。\\n\
    体の震えがにわかに止まり、代わりに馴染み深い感覚が覆う。\\n\
    これから起こることへのじくじくとした予感。\\n\
    \\n\
    これだ。「普通の人φ」と私の違いが露わになる瞬間だ。\\n\
    私は声を出せない。それが明らかになった時、\\n\
    奇異、同情、嫌悪、憐憫。\\n\
    私への視線が帯びる意味は不可逆に変わる。\\n\
    \\n\
    そして、彼女もそうなのだろう。ただでさえ彼女は激怒している。\\n\
    無様にもたつけば、火に油を注ぐ結果になることは目に見えている。\\n\
    なんども繰り返されたことが、ここで再び起こるだけだ。\\n\
    いや、そのうえで今回は本当に殺されてしまうかもしれない。\\n\
    それでも、仕方ない。仕方がないのだ。\\n\
    \\x[noclear]\\n\
    苦い諦観を飲み込もうとしたとき、彼女の口が開く。\\_w[1200]\\n\
    \\0\\c\\![bind,ex,こわいかお,0]あなた、声が出せないのでしょう？\\n\
    \\1\\c！\\n\
    \\0発声に筋肉を使っていないから、顎周りの血色がわずかに薄い。\\n\
    口を必要以上に固く結んでいるのも、そもそも口を開く意味がないから。\\n\
    そうやって生きてきたのなら、鞄の中に筆談の準備もあるのでしょう。\\n\
    \\n\
    「見てφ」あげる。その目つきからして、言い分があるのだろうから。\\n\
    \\n\
    \\1…………。\\n\
    \\n\
    ……どうして。\\n\
    私は何も、言っていないのに。\\n\
    私の身体が示すわずかな兆候を読み取り、\\n\
    彼女はこともなげに言い当ててみせた。\\n\
    \\x[noclear]\\n\
    …………。\\n\
    \\n\
    言われるまま取り出したノートに、涙が滲む。\\n\
    こんなことで。いま、私は殺されかけているのに。\\n\
    \\n\
    醜く苦しい発覚を待たず、事前に気づいてもらえた。\\n\
    こんなことで、私が私として受け入れられたとさえ感じる。\\n\
    こんなことが、これっぽっちのことが、幸せなのだ。\\n\
    \\x[noclear]\\n\
    死にたい。\\n\
    幸せであることが、みじめだ。\\n\
    死にたい。どんなときよりも純粋に願った。\\n\
    \\x\
    h1000000\\1気づけば、女幽霊の顔がすぐ近くにあった。\\n\
    覗き込まれたノートには、\\n\
    『おねがいだから、死なせて』\\_w[1000]\\n\
    ……私の気持ちそのものが、\\n\
    あまりにも無防備に書き殴られていた。\\x[noclear]\\n\
    \\x
    h1111110\\c…………。h1123211\\![bind,シルエット,,0]\\p[2]\\![bind,icon,,0]{}\\0くく、ふふふ。\\n\
    h1123201ああ、おかしい。h1123204あなた、ここに死にに来たの？\\n\
    \
    \\1……空気が、緩んだ……？\\n\\n\
    \
    h1113306……こういう方向から来るのは初めてね。\\n\
    h1113201いいわ、h1113204気に入った。\
    \
    \\1……助かった、のだろうか。\\n\
    \\x\
    \
    h1111204命は取らないでおいてあげる。\\n\
    h1111206ああ、あなたはそれがお望みだったかしら？\\n\
    h1111210なんにせよ、それは止めよ。\\n\
    h1111201その代わりにあなた、しばらくここに居なさい。\\n\
    \\n\
    h1111204土足で踏み込んだ報いを与えなければね。\\n\
    h1111206私はともかく、彼らが黙っていないもの。\\n\
    h1111210まあ、今回は丁度いいわ。\\n\
    \
    \\1……私になにをしろと言うのだろう。\
    \\x\
    \
    h1111206話し相手がいなくて退屈していたところだったの。\\n\
    退屈は死よりもつらいもの。\\n\
    h1111211だからお話をしましょう、お互いのために。\\n\\n\
    h1111201私はハイネ。幽霊屋敷の主。\\n\
    h1111210訪問者\\f[bold,1]{{user_name}}\\f[bold,0]、この家の主として、あなたの訪問を歓迎します。\\n\
    h1111204せいぜい楽しませてちょうだい。\\n\\nh1000000\
    \
    \\1いつの間に名前を……。\\n\
    しかし、口を挟む余地はない。\\n\
    客間の椅子を指さすハイネの手。\\n\
    席につけということだ。……従うしかない。\\n\
    当然だが、時間は捨てるほどにある。\\n\
    \\n\
    テーブルを挟み、向かい合って座る。\\n\
    \\n\
    \\0h1111211協力的で結構なことね。\\n\
    h1111201ところで{{user_name}}、\\n\
    h1111204幽霊の淹れるお茶を飲んだことはあるかしら？h1111211\
    \\1彼女の微笑みは謎めいて親しげだった。\
    ",
    (0..IMMERSIVE_ICON_COUNT).map(|i| format!("\\![bind,icon,消え{},1]", i+1)).collect::<Vec<String>>().join(""),
    shake("あなたはなぜここへ来たの？"),
    (0..IMMERSIVE_ICON_COUNT).map(|i| format!("\\![bind,icon,没入度{},1]", i+1)).collect::<Vec<String>>().join(""),)
});

pub(crate) static FIRST_RANDOMTALKS: Lazy<Vec<String>> = Lazy::new(|| {
  vec!["\
      h1111206いま、別の者にお茶の準備をさせているわ。\\n\
      \\n\
      h1111201さて。\\n\
      h1111204それで、ここには死ににきたのだったわね。\\n\
      \\n\
      h1113210……相当な覚悟、あるいは絶望か。\\n\
      強い想いがなければ決断できなかったでしょう。\\n\
      h1113205なにがあなたを追い詰めたのかしらね。\\n\
      学校、仕事、家庭環境……h1113206あるいは、名前もつけられないほど微妙で、それでいて耐えられないなにか。\
      \\c\
      h1111204ああ、話せなんて言わないわ。\\n\
      話したければそうすればいいけれど、まあ、今はそうではないでしょう？\\n\
      \\n\
      それに、それを聞いて、私があなたを救うこともない。\\n\
      無為な希望を持たないように、あえて言っておくけれどね。\\_w[1200]\\n\
      \\n\
      死者が生者にできることなどたかが知れているし、\\n\
      あなたの生死は、h1111210なんというか、あまり大きな関心事ではないから。\
      \\x\
      ……h1111201あなたに興味がないわけではないのよ。\\n\
      h1111210もしそうならば引き止めたりせずに追い出しているわ。\\n\
      h1111204勘違いしてほしくないのは、\\n\
      あなたの宿痾に特別な興味はないということ。\\n\
      h1111210あなたの食事の好み、\\n\
      やめられない癖、\\n\
      過去に犯した罪、\\n\
      好みの散歩ルート、なんでもいいの。\\n\
      h1111205この倦み腐った脳に刺激を与えてくれるなら、情報に貴賤はないわ。\
      \\x\
      ……h1111210なにせ、私はここをろくに動けない身だから。\\n\
      h1112205ずっと、ずっと、ずっと、退屈だったの。\\n\
      h1111204そんなところにあなたという玩具が\\n\
      転がりこんできたものだから、\\n\
      都合のいい遊び道具として使おうと考えたのよ。\\n\
      \\n\
      ……h1111210ふふ、ここまで言われても怒らないのね。\\n\
      とても、根深い。h1111211ますます気に入ったわ。\
      \\x\
      h1111204ともかく。逝きたくなったら、そうすればいい。\\n\
      必要ならばいくらか手助けもしましょう。\\n\
      ただ、それまでは私の話し相手になってもらうわ。\\n\
      いいわねφ？\\_w[750]{user_name}。\
      ".to_string(),

      "\
      \\1(コンコン)\\_w[1250]\\n\
      h1111203入りなさい。\\n\\1ハイネの後方、客室のドアが開き、なにかが静かに入ってきた。\\n\
      ……カップとポット。ティーセットだ。浮いている。透明な何かに支えられているかのようだ。\\n\
      \\n\
      h1111203契約している霊よ。召使のようなもの。\\n\
      ……h1141101ああ、h1111204あなたには見えないのかしら？低級霊だものね。\\n\
      \\n\
      ……h1111206そう、ならば伝えておく必要があるわね。\\n\
      この部屋には、常に数人の召使がついているの。\\n\
      h1111201……h1111204驚いた？まあ、普段は居ないのとそう変わらないわ。\\n\
      お茶のおかわりが欲しかったら、h1111306そうね……あのあたりに合図を送ればいいわ。\\n\
      \\x\
      h1111204彼らはみな、私と契約している霊たち。\\n\
      私は力が強いから、それで彼らの……まあ、身の安全を保障しているの。\\n\
      代わりに、彼らは私の命令に従う。\\n\
      これ以上なく忠実にね。\\n\
      \\x\
      h1111203霊にとっての契約は、生者のそれとは重みが違うわ。\\n\
      h1111206なにせ、文字通り存在をかけて結ぶものだから。\\n\
      なまなかな誤魔化しはきかず、反故にすることもできない。\\n\
      h1113210肉体は重くはあれど強固な鎧だったのだと、死んだ後からしみじみ思うわ。\
      \\x\
      h1111204……混乱しているかしら。\\n\
      今すぐにすべてを理解する必要はないわ。\\n\
      どうせ時間はたっぷりあるのだから。\\n\
      \\n\
      ほら、お茶を飲んで。\\n\
      \\1勧められるままに、私は深赤色の液体を口に含んだ。\\n\
      ……まろやかな苦味の後に、薬草を想わせる複雑な香りが広がる。\\n\
      深く、コクのある味わいだ。……美味しい。\\n\
      h1111211悪くないでしょう？h1111204それが私のお気に入り。\\n\
      ……h1111211これで、私の好物を1つ知れたわね。\\n\
      h1111204全て、このように。\\n\
      じっくり、互いを知っていけばいいのよ。\
      ".to_string()
  ]
});

// 話し相手を失いたくない
// 本音ではハイネはユーザを帰したくない
pub(crate) static FIRST_CLOSE_TALK: &str = "\
    h1111201あら、今日はやめるの？h1111204そう。\\n\
    \\n\
    ……ねえ、{user_name}。\\n\
    今日はもう遅いし、泊まっていきなさい。\\n\
    部屋なら空いているし、\\n\
    あなた自身、帰るつもりもなかったのでしょう？\\n\
    \\1……。片道の旅のつもりでいたのは、その通りだ。\\n\
    \\0\\n\
    h1111204……決まりね。\\n\
    h1111205…………本音を言うとね、手放したくなどないの。\\n\
    生者の話し相手なんて、次はいつ手に入るかわからないもの。\\n\
    \\n\
    h1111210あなたは死にたいという。\\n\
    私はあなたのため、そして私のために、\\n\
    それを尊重するわ。\\n\
    h1111204けれど同時にこうも思うの。\\n\
    生きたあなたと話していたい。\\n\
    \\1……。\\n\
    \\0\\n\
    h1111211だから、私はあなたに頼み事をするわ。\\n\
    いつになっても良いから、あなたを看取らせてほしい。\\n\
    そしてそれまで、ここにいてほしい。\\n\
    ……h1111205返事はいらないわ。\\n\
    行動で示してくれればいいの。\\n\
    私はここを離れない。ずっと待っているから。\\n\
    \\n\
    これで、話は終わり。\\n\
    h1111204さあ、もう行きなさい。h1111206部屋は彼らに案内させるわ。\\n\
    \\x[noclear]\\n\
    h1111210終わりの時が遠いのならば、\\n\
    せめて、良い夢を。\\n\
    \\n\
    おやすみなさい、{user_name}。";

fn shake(text: &str) -> String {
  let mut s = String::new();
  let shakes = [(10, 10), (-14, -14), (4, 4)];
  for (i, c) in text.chars().enumerate() {
    if i < shakes.len() {
      s.push_str(&format!(
        "\\![moveasync,--X={},--Y={},--base=me]{}",
        shakes[i].0, shakes[i].1, c
      ));
    } else {
      s.push(c);
    }
  }
  s
}
