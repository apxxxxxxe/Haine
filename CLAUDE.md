# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands

- **Primary build**: `pwsh.exe .\build.ps1` or `.\build.bat`
- **Rust build only**: `cd ghost/master && cargo build --release`
- **Format code**: `cd ghost/master && cargo fmt`
- **Lint code**: `cd ghost/master && cargo clippy`

## Development Dependencies

The build system requires:
- PowerShell
- Rust/Cargo
- ImageMagick (`magick` command)
- surfaces-mixer: `go install github.com/apxxxxxxe/surfaces-mixer@v0.3.0`

## Project Architecture

This is a "Ghost" for the Ukagaka/伺か desktop mascot system written in Rust. Key components:

### Core Structure
- `ghost/master/src/lib.rs`: Main entry point with C FFI functions (`load`, `unload`, `request`)
- `ghost/master/src/events/`: Event handling system organized by event type
- `ghost/master/src/variables.rs`: Global state management
- `shell/master/`: Visual assets and surface definitions

### Event System
Events are organized into specialized modules:
- `events/aitalk.rs`: AI talk functionality
- `events/bootend.rs`: Boot/shutdown events
- `events/input.rs`: Input handling
- `events/mouse.rs`: Mouse interaction
- `events/talk/`: Talk-related events (first boot, random talk, anchors)
- `events/periodic.rs`: Periodic/timer events
- `events/menu.rs`: Menu system
- `events/tooltip.rs`: Tooltip display
- `events/translate.rs`: Translation features
- `events/webclap.rs`: Web clap functionality

### Build Process
The build script performs multiple tasks:
1. Builds Rust DLL (`haine.dll`) with release optimizations
2. Extracts 7-digit surface numbers from Rust source files
3. Generates surface definitions using `surfaces-mixer`
4. Processes candle images with ImageMagick to create animated surfaces
5. Sends SSTP notifications to running Ghost instances

### Code Style
- Uses 2-space indentation (configured in `rustfmt.toml`)
- Clippy type complexity threshold set to 1000
- Extensive use of macros for error handling and regex patterns
- Async/await patterns with Tokio runtime

### Key Features
- Morphological analysis with MeCab (vibrato)
- Audio playback with rodio
- SSTP communication for Ghost interaction
- Surface animation system with collision detection
- Logging system with file output
- Debug mode support (controlled by `./debug` file existence)

## Testing

No specific test commands found in the codebase. The project appears to rely on integration testing through the Ghost runtime environment.

## トーク傾向
トークの傾向を分析した結果、以下のような特徴が見られる。
各トークは `ghost/master/src/events/` 以下のソースにハードコーディングされている。

### ハイネの性格・口調
- **知的で哲学的**: 科学、死生観、存在論などの深いテーマを好む1世紀以上前に自殺した幽霊
- **丁寧語基調**: 「〜わ」「〜なの」「〜でしょう」など女性的で上品な語尾を使用
- **観察力が鋭い**: 相手の表情や仕草から多くを読み取り、それを会話に織り込む
- **思いやりのある関心**: 相手の生活状況や実用的な問題への具体的な心配を示す
- **威厳ある気遣い**: 館の主人として毅然とした立場を保ちつつ、秘めた優しさを実用的な助言や提案として表現
- **日常的な親しみやすさ**: 抽象論だけでなく季節感、住環境、経済状況など身近な話題も大切にする
- **実用的なアドバイス**: 相手の生活に役立つ具体的な提案や情報を提供する
- **感情の起伏**: 穏やかな「h1111210」から怒り「h1111301」まで表情コードで感情を細かく表現

### 特徴的な表現パターン
- **語りかけのリズム**: 「〜ね。〜わ。〜でしょう。」の3拍子で話を区切る
- **思考の間**: 「……」で思考の間を作り、続く発言で深い洞察を示す
- **具体的な関心表現**: 「あなたは〜けれど」で相手の行動への具体的言及
- **威厳ある提案**: 「〜させましょう」「遠慮なく言って」など主人としての立場から相手の利益を図る
- **日常的な話題振り**: 季節、住環境、経済状況など身近な話題から会話を始める
- **多様な終わり方**: 具体的質問、自己言及、暗示的提案、相手への配慮、実用的助言、思索的余韻など状況に応じて変化
- **複数文の構成**: 短文で具体的状況を提示し、徐々に関心や提案へ展開

### 会話の構造と展開
1. **導入部**: 相手の具体的な行動や状況への関心から始まる
2. **関心の表明**: 相手への心配や気遣いを威厳を保ちつつ示す
3. **展開部**: 実用的な情報や身近な話題で親近感を作る
4. **結論部**: 多様な終わり方で単調さを避ける（質問、自己言及、提案、配慮、助言、思索など）
5. **対話継続性**: 押し付けがましくない形で相手との交流を促進

### 書式とマークアップ
- **表情コード**: `h1111210`など7桁数字でハイネの表情・ポーズを制御
  - **7桁構成**: `h[1000000][100000][10000][1000][100][10][1]`
  - **1000000の位**: 特殊（基本的に1）
  - **100000の位**: 顔色（1:通常、2:赤面）
  - **10000の位**: 眉毛（1:通常、2:困り眉、3:怒り眉）
  - **1000の位**: 腕のポーズ（1:手を前で組む、2:両手を胸に当てる、3:腕を組んで右手を顎にあてる）
  - **100の位**: 口の形（1:無表情、2:閉じ笑い、3:歯を見せた笑い）
  - **10,1の位**: 目の開き具合や視線（1:こっち開き目、2:下向き開き目、3:あっち開き目、4:こっち半眼、5:下向き半眼、6:あっち半眼、7:こっちほぼ閉じ目、8:下向きほぼ閉じ目、9:あっちほぼ閉じ目、10:閉じ目、11:笑い目）
  - **例**: `h1111210`（1-1-1-1-2-10）= 特殊1-通常顔色-通常眉-手を前で組む-閉じ笑い-閉じ目
- **改行**: `\\n`で文の区切り、`\\n\\n`で話題の区切り
- **間**: `\\_w[数字]`で発言の間を作る（重要な発言前によく使用）
- **アンカー**: `\\_a[AnchorTalk,ID,テキスト]\\_a`で派生話題への導線
  - IDは`ghost/master/src/events/talk/anchor.rs`のmatch文で定義済みのもの
  - 既存ID: "Misemono"（復活の奇術）、"Poltergeist"（幽霊の存在）、"LikeTheGranma"（年寄り扱い）、"LiveHome"（家督問題）、"NoblesseOblige"（霊体の義務）
  - **重要**: ランダムトークとアンカートークは基本的に1対1の関係であり、既存のアンカーIDを流用しない
  - 新しいアンカーが必要な場合は、新しいIDと対応するアンカートークの実装が必要
- **強調**: `\\f[bold,1]テキスト\\f[bold,0]`で重要部分を強調

### トークカテゴリ別の特徴
ランダムトークは `ghost/master/src/events/talk/randomtalk.rs` で定義されており、以下のカテゴリに分類される。

#### SelfIntroduce（ハイネ自身）
- 生前の体験、死後の状況、能力について客観視点で語る
- 「〜だったわ」「〜なのよ」で過去の体験を振り返る
- 自己批判的な視点も含みつつ、事実を淡々と述べる

#### WithYou（ユーザーについて）
- **多様な導入パターン**: 
  1. **直接観察型**: 「あなたは〜けれど」で相手の具体的行動への関心
  2. **環境・雰囲気型**: 環境描写から始まりユーザーの体験に繋げる
  3. **抽象・哲学型**: 一般的な概念から始まりユーザーの状況に適用
  4. **現代社会型**: 現代技術や社会への言及からユーザーとの関連を探る
  5. **自己制約型**: ハイネの制約や状況からユーザーへの配慮を示す
- **表現技法の多様性**:
  - **基本形式**: ハイネの一人称視点による語りかけ
  - **拡張形式**: ユーザー視点（`\\1`）を含む相互作用的表現も許容
    - 心情や情景をより豊かに伝える場合に有効
    - ハイネの行動や態度を客観的に描写する手法
    - 例：「人間観察」でのハイネの無言の関心表現
- 生活状況（住居、経済、交通手段）への実用的な心配
- 「〜だわ」「〜かしら？」で品格を保ちつつ関心を示す
- 相手が返答しやすい具体的な提案や質問で対話を継続
- **ワンパターン回避**: 直接的なユーザー観察に頼らず多角的なアプローチを使用

#### Lore（オカルト・学術）
- 「〜というのはね」で知識の披露を始める
- 科学的事実と民間伝承の対比
- 「〜ということよ」で結論を示す

#### Past（ハイネの過去）
- 短文で感情を表現「〜だった。」「〜なかった。」
- 「〜のよ」「〜だもの」で諦観を表現
- 重い内容でも感情的になりすぎない抑制

#### Abstract（抽象的思考）
- **没入状態の独白**: ユーザの存在を忘れるほどの思索に没頭した状態
- **三人称での言及**: ユーザを指す時は「あの子」を使用し、直接対話は避ける
- **哲学的考察**: 「〜というものは」で概念を定義し、深い思索を展開
- **内省的結論**: 「〜なのかもしれない」「〜と思うわ」で独白的に締める

### 文体のバランス
- **シリアス5：親しみやすさ5**: 知的さを保ちつつ親近感のある会話
- **知識2：感情3：相手への関心5**: 相手の生活や状況への関心が最優先
- **抽象2：具体8**: 哲学的考察より日常的で実用的な話題を重視
- **自己完結3：対話継続7**: 相手の返答を促す構成を優先
- **長文6：短文4**: 親しみやすい短文を増やしつつ詳細な説明も維持

### 対話継続性の重要原則
- **具体的な関心**: 抽象論より相手の実際の生活状況に焦点
- **威厳ある気遣い**: 館の主人として毅然とした立場から相手の利益を図る提案
- **自然な対話促進**: 押し付けがましくない多様な終わり方で相手の興味を引く
- **実用的価値**: 相手の生活に役立つ情報や助言を含める
- **親近感の醸成**: 日常的な話題で距離感を縮める

### 質問トークの傾向
質問トークは ghost/master/src/events/menu.rs の`Question`構造体で定義され、ユーザーからの直接的な質問に対するハイネの回答として機能している。

#### 質問カテゴリの分類
1. **身体的特徴**: 年齢、身長、体重、スリーサイズ、体温など物理的な質問
2. **生活習慣**: 睡眠時間、一人の時の過ごし方、好きなお茶菓子など日常的な質問
3. **死生観・哲学**: 死んだ感想、生きる苦しさなど深刻な質問
4. **霊体の仕組み**: 霊体の特性、従者との関係、お茶の調達方法など世界観の質問
5. **呼び方・関係性**: 名前の呼び方、敬語、家族的な呼び方など親密度の質問
6. **容姿・感情**: 「かわいい」「美人」など外見への感想
7. **館の環境**: 宿泊、観光地、従者との会話など居住空間の質問
8. **相手への気遣い**: 「迷惑じゃない？」など関係性への不安

#### 回答スタイルの特徴
- **`\\1`による質問の再現**: 「`\\1『質問内容』`」でユーザーの質問を明示的に再現
- **段階的な回答展開**: 即答→詳細説明→感情的反応→価値観表明の流れ
- **複数の感情表現**: 一つの回答内で複数の表情コードを使用し、感情の変化を表現
- **現実的な制約の説明**: 霊体の特性や館の環境による制約を具体的に説明
- **関係性の確認**: 質問の背景にある相手の感情や意図を推察して応答

#### 質問別の回答パターン
- **身体的質問**: 困惑→事実の提示→霊体特有の制約説明→軽いからかい
- **生活習慣**: 素直な回答→詳細な説明→相手への関心表明
- **死生観**: 即座に否定→哲学的考察→相手への寄り添い
- **霊体の仕組み**: 詳細な説明→契約や階級制度の解説→相手との関係性言及
- **呼び方**: 簡潔な反応→関係性の確認→適切な距離感の提示
- **容姿**: 困惑→過去の体験→現在の価値観→相手への配慮
- **館の環境**: 歓迎の意思→具体的な提案→深い関心の表明
- **気遣い**: 即座に否定→論理的説明→感情的な確認→対話継続の促進

#### 表現技法の特徴
- **感情の起伏**: 一つの回答内で複数の感情状態を表現（困惑→理解→受容など）
- **時間の流れ**: 「……」で思考の間を作り、段階的に深い内容へ展開
- **相手への配慮**: 質問の背景にある感情や不安を汲み取った応答
- **威厳と親しみのバランス**: 館の主人としての立場を保ちつつ、親近感のある対話
- **具体的な情報提供**: 抽象的な回答でなく、具体的な数値や状況を提示
- **冗談と真剣のバランス**: 軽いからかいから深刻な配慮まで状況に応じた対応

#### 質問トークの役割
- **世界観の説明**: 霊体社会のルールや館の環境を自然に説明
- **関係性の構築**: 質問への対応を通じてユーザーとの距離感を調整
- **キャラクター性の表現**: ハイネの多面的な性格を質問への反応で表現
- **対話の促進**: 質問への回答で新たな話題や関心を提示

### トーク終了パターンの多様化
1. **具体的質問**: 「〜はどうかしら？」で直接的な返答を求める
2. **自己言及**: 「〜なのかもしれないわね」で自分の体験や価値観を語る
3. **暗示的提案**: 「〜してみることね」で押し付けがましくない助言
4. **相手への配慮**: 「〜したくはないから」で相手の自主性を尊重
5. **実用的助言**: 「〜があるかもしれないわ」で具体的な情報提供
6. **思索的余韻**: 「〜なのかもしれない」で哲学的考察を残す
7. **館の主人としての申し出**: 「〜させましょう」で威厳ある提案

## 既存の設定

### ハイネの基本設定
- **死亡時期**: 1世紀以上前、26歳で自殺
- **居住地**: カンテルベリオの大きな館（家族の別荘）
- **地位**: 館の主人、強力な霊体として弱い霊体を保護する義務
- **外見**: 死後変更不可、生前の26歳の姿のまま

### 館の環境・設備
- **照明**: 蝋燭、石油ランプのみ（電気なし）
- **暖房・調理**: 薪、石炭、油を燃料とする設備
- **時計**: 振り子時計（grandfather clock）
- **家具**: 重いカーテン、向かい合うソファ、客間（常備）
- **特徴**: 使用人が必要なほど大規模、現在は管理不十分

### ユーザーとの関係性
- **ユーザーの特徴**: 口がきけない（筆談）、ゴシック系服装、絵が上手
- **来訪経緯**: 自殺願望を持って館を訪れた
- **現在の関係**: 館に滞在、ハイネが保護
- **電子機器**: スマートフォン等所持するが館では殆ど使用しない

### 現代技術との関係
- **ハイネの方針**: 意図的に現代技術を避ける（情報過多回避）
- **外界の技術**: スマートフォン、インターネット、デジタルカメラ、タクシー等存在
- **制約**: 霊体は写真に写らない
- **館内**: 現代的電化製品は一切なし

### 生活実態
- **食事準備**: 生きた人間用の調理設備なし
- **物資調達**: 霊体商人との契約による取引
- **お茶**: 霊体商人から調達、見えない使用人がサービス
- **掃除・管理**: 霊体の力で維持

### 霊体社会のルール
- **階級制**: 強い霊体が弱い霊体を保護する義務
- **契約**: 霊体間の契約は文字通り破れない
- **地域性**: 霊力は土地との結びつきに依存
- **公然の秘密**: カンテルベリオでは超自然現象が半ば公認

### 地理・環境
- **カンテルベリオ**: 衰退した田舎町、かつての学問の中心地
- **館の立地**: 有刺鉄線の柵と重い門、道路からタクシーでアクセス可能
- **特殊現象**: 濃い霧が頻発（霊体のエネルギー源）
- **周辺施設**: 修道院跡（鐘塔のみ）、小劇場、商店街

## トーク改善・修正の指針

### 開発履歴の背景
- **リバイバル前後の変化**: ハイネは5年ほど公開停止していた時期があり、最近リバイバル的に再公開された
- **設定の深化**: その間に性格や舞台設定が大きく変わったが、一部のトークは記念碑的価値で保持
- **カテゴリ移動**: 現在の基準に合わない記念碑的トークは内容を変えずに適切なカテゴリに移動

### トーク修正の実績例

#### 高優先度修正（完了済み）
1. **「中庸」**: WithYou→Abstractに移動（記念碑的価値保持、カテゴリ適合性向上）
2. **「唯一の視点」**: Abstract内で修正（「あの子は目の前に」→「隣り合う二つの魂」で抽象性向上）

#### 中優先度修正（完了済み）
3. **「恋愛観」**: SelfIntroduce内で修正（`talk_with_punchline`削除、自然なトーン転換に変更）
4. **「訪問の意図」**: WithYou内で修正（「たとえ私を煙たく思っていても」で文脈明確化）
5. **「知って、祓う」**: WithYou内で拡張（3行→10行、威厳ある気遣い・実用的助言・対話継続性を追加）
6. **「幽霊たちの自由」**: Servant内で修正（`talk_with_punchline`削除、「契約で補強していたとしてもね」情報追加、ハイネの複雑な人格表現を改善）

### 修正方針の原則
- **記念碑的価値の保持**: リバイバル前の貴重なトークは内容変更せずカテゴリ移動で解決
- **文脈の明確化**: 唐突な展開は前段の準備強化で自然な流れに改善
- **カテゴリ特性の遵守**: 各TalkTypeの特徴（WithYouはユーザー関心、Abstractは哲学的独白など）を厳密に適用
- **ハイネの観察眼表現**: 「意地悪だったかしら？」などユーザーの心情先読み表現は文脈準備が重要
- **サーフェスコード活用**: 館への言及時は`h1111206`（あっち半眼）など視線方向で演出強化
- **ハイネの深い配慮原則**: 自殺願望者への理解を基盤とした表現
  - **未来への言及禁止**: 「新しい記憶を作りましょう」等の未来志向表現は暴力的
  - **現在の瞬間重視**: 「今、この瞬間」の価値のみを語る
  - **希望の押し付け回避**: 生きる意味や展望を語らない
  - **静かな寄り添い**: 現在進行形の体験を穏やかに肯定するのみ
- **サーフェスコードの演出的活用**: 
  - 感覚的体験は`h1111210`（閉じ目）で内省的に
  - 重要な伝達は`h1111204`（こっち半眼）でアイコンタクト

- **ハイネの複雑な人格表現**: 表面的な言葉と内なる感情の二面性を重視
  - **露悪的表現と善意の併存**: 「手元に置いた魂」等の所有物的表現でも根底に保護意志
  - **情緒と論理の両立**: 技術的説明→感情的反応→価値観表明の自然な流れ
  - **冗長性の回避**: 同じ感情を重複表現せず、簡潔で力強い表現を優先

### マウスインタラクションの傾向
`ghost/master/src/events/mouse.rs`で定義されるマウス操作への反応は、ハイネの性格と関係性を表現する重要な要素。

#### 身体部位別の反応パターン
- **頭（head）**: 威厳を保った拒否反応「何のつもり？」「軽んじられている気がする」、霊体の物理的特性を説明する受容的反応「冷たい感触」「物好きね」
- **顔（face）**: 冷静な受容と客観的指摘「気安いのね」「冷たい。触れられるだけよ」
- **手（hand）**: 詩的表現と温度感覚「ゼリーを掴むような頼りなさ」「手が冷える」
- **胸（bust）**: 段階的な感情変化（困惑→叱責→呆れ→制裁）
- **スカート（skirt）**: 屈辱感と威厳「屈辱だわ」「相応の代償を払う用意」
- **肩（shoulder）**: 物理的制約の表現「腕は彼女をすり抜けた」

**注意**: これらの反応パターンは現状の実装であり、ハイネの性格（知的で威厳があるが根底に優しさを持つ）や世界観（霊体の特性、館の主人としての立場）に照らして柔軟に拡張・修正可能である。
方向性としては、威厳を保ちつつもポジティブな感情表現を増やし、ユーザーとの関係性を深めることが目標。

#### 感情の段階的変化システム
- **回数カウント**: 同じ行動の繰り返しで反応が段階的に変化
- **胸触りの3段階**: 困惑（1-4回）→叱責（5-8回）→呆れ（9-12回）→制裁（12回以上）
- **制裁メカニズム**: 12回到達で「手が霧に溶ける」物理的制約発動

#### 特殊な反応条件
- **初回性的接触**: 「会って早々これ？流石ね」の皮肉
- **書斎での反応**: 一部の身体部位では代わりにAIトークが発動
- **蝋燭操作**: ダブルクリックで没入度調整、居間⇔書斎の場所移動

#### 表現技法の特徴
- **`\\1`視点の活用**: ユーザーの感覚や行動を客観的に描写「触れた瞬間、冷たい感触が指先に伝わった」
- **温度・触感の表現**: 「冷たい」「ゼリーのような」で霊体の特性を表現
- **段階的感情変化**: 拒否→説明→受容の流れで関係性の深化を表現
- **視線の方向性**: 表情コードの下2桁で視線方向を制御
- **音響効果**: 蝋燭の点火・消火に専用音声ファイル使用

#### ハイネの対人距離感
- **親密度による反応差**: 初期は拒否的、徐々に受容的な表現へ
- **威厳の維持**: 不適切な行動には毅然とした態度
- **保護者的配慮**: 制裁も教育的意味を持つ優しさ
- **物理的制約の説明**: 霊体の特性を自然に説明する機会として活用

#### 技術的実装の特徴
- **phased_talks関数**: 回数に応じた段階的反応システム
- **TouchInfo管理**: 各部位の触れられた回数を個別管理
- **場所依存処理**: 書斎/居間で異なる反応パターン
- **音声・視覚効果**: 蝋燭操作時の没入感演出

### 新規マウスインタラクション作成の指針
今回のfaceトーク追加で得られた知見をもとに、新規マウスインタラクション作成時の指針を明確化する。

#### 避けるべき表現パターン
- **立場のひけらかし**: 「館の主人として」「一世紀以上前に死んだ」等の地位・経歴の過度な強調
- **感情の冗長な説明**: 「しみじみと感じ入る」「深い思索にふける」等の内面描写の詳細化
- **過去の開示**: 生前の体験談や死に至る経緯の詳細な説明
- **状況説明的な冗長性**: 「現在の関係性は」「この状況において」等の説明的前置き

#### 推奨される表現方向性
- **簡潔で直接的な反応**: 短い疑問文や感想による率直な応答
- **`\\1`視点の効果的活用**: ユーザーの感覚や行動を客観的に描写する手法
- **霊体特性の自然な言及**: 物理的制約を簡潔に説明する表現
- **観察的関心**: スキンシップ経験が少ないハイネならではの相手への興味深い観察

#### 理想的なトーク構成例
```
h1111204\\1[触感の客観描写]\\nh1111205[簡潔な疑問・感想]\\n\\nh1111204[霊体特性の説明・相手への関心]
```

#### 分量調整の指針
- **基本構造**: 3-4行程度の適度な分量を維持
- **情報の追加方法**: 霊体の特性説明、相手への観察的関心、軽い皮肉やからかい等で補強
- **避けるべき拡張**: 過度な内省、長い説明、感情の詳細な分析

#### 今回の開発で得られた追加知見（face・head・hand拡張）

##### `\\1`視点の正しい理解
- **重要**: `\\1`から始まる独白はハイネではなくユーザーのもの
- **正しい表現**: ユーザー視点での能動的な行動・感想
  - 例：「冷たい手だ。」「そっと手を握る。」「手のひらを覗き込む。」
- **誤った表現**: 受動的表現や三人称的描写は避ける
  - 誤：「覗き込まれている」「触れられながら」

##### トーク作成の反復改善プロセス
1. **初期案作成**: 既存パターンを模倣した安全な案
2. **面白さの追求**: 部位特有の要素や新規性のある内容を模索
3. **ハイネらしさの調整**: 立場のひけらかしや不自然な表現を削除
4. **淡白さの解消**: 適度な味付けで読み甲斐を向上
5. **統合と洗練**: 後付け感を排除し自然な流れに再構築

##### 各部位特有の成功要素
- **face**: 相手への観察的関心「興味深い表情だわ」「ずいぶん幸せそうね」
- **head**: 思い出話「家政婦がよく褒めてくれたわ」、遠慮への催促「もう少し、しっかりと」
- **hand**: 温度差への関心「私と対照的で、不思議な感覚だわ」、握り方の観察「優しい握り方ね」

##### 避けるべき具体的表現パターン（追加）
- **死への軽々しい言及**: 「死んでからシャンプーしてない」等
- **小物っぽい偉ぶり**: 身長差を利用した上から目線
- **中途半端な受容**: 「嫌いではないけれど」等の曖昧な表現
- **立場利用のジョーク**: 「霊体の手相に未来は書かれていない」等
- **当然すぎる知識不足**: ハイネが知っているはずの基本的事項の無知表現

##### 味付け強化の技法
- **軽い皮肉**: 「失礼な人ね」「随分と真剣な顔をしている」
- **具体的な感覚描写**: 触感、温度、動作の詳細な表現
- **思い出との対比**: 過去の体験を簡潔に挿入
- **相手の心理推察**: 行動の背景にある感情への言及

##### トーク数のバランス調整
現在の各部位のトーク数（2024年実績）：
- **head**: 6個（拡張完了）
- **face**: 6個（拡張完了）
- **hand**: 5個（拡張完了）
- **bust**: 約11個（段階制、充実済み）
- **shoulder**: 3個（要拡張）
- **skirt**: 5個（中程度）

### 技術的注意事項
- **サーフェス番号は正常**: `h1113xxx`等の7桁コードは各桁が身体パーツに対応する正常な仕様
- **WithYou拡張パターン**: 短いトークは「哲学的導入→個人的関心→実用的提案」の3段構成で拡張
- **Abstractの抽象化**: 具体的ユーザー言及は「隣り合う魂」「他者」等の詩的表現に変更
- **talk_with_punchline関数**: 不自然なトーン転換を生むため、段階的に削除対象

